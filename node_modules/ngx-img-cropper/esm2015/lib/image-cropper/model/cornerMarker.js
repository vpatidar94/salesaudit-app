import { Handle } from './handle';
export class CornerMarker extends Handle {
    constructor(x, y, radius, cropperSettings) {
        super(x, y, radius, cropperSettings);
    }
    drawCornerBorder(ctx) {
        let sideLength = 10;
        if (this.over || this.drag) {
            sideLength = 12;
        }
        let hDirection = this.cropperSettings.markerSizeMultiplier;
        let vDirection = this.cropperSettings.markerSizeMultiplier;
        if (this.horizontalNeighbour.position.x < this.position.x) {
            hDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        if (this.verticalNeighbour.position.y < this.position.y) {
            vDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        ctx.beginPath();
        if (this.cropperSettings.cropperDrawSettings.lineDash) {
            ctx.setLineDash([1, 3]);
        }
        ctx.lineJoin = 'miter';
        ctx.moveTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.closePath();
        ctx.lineWidth = this.cropperSettings.cropperDrawSettings.strokeWidth;
        ctx.strokeStyle =
            this.cropperSettings.cropperDrawSettings.strokeColor ||
                'rgba(255,255,255,.7)';
        ctx.stroke();
    }
    drawCornerFill(ctx) {
        let sideLength = 10;
        if (this.over || this.drag) {
            sideLength = 12;
        }
        let hDirection = this.cropperSettings.markerSizeMultiplier;
        let vDirection = this.cropperSettings.markerSizeMultiplier;
        if (this.horizontalNeighbour.position.x < this.position.x) {
            hDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        if (this.verticalNeighbour.position.y < this.position.y) {
            vDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        if (this.cropperSettings.rounded) {
            const width = this.position.x - this.horizontalNeighbour.position.x;
            const height = this.position.y - this.verticalNeighbour.position.y;
            const offX = Math.round(Math.sin(Math.PI / 2) * Math.abs(width / 2)) / 4;
            const offY = Math.round(Math.sin(Math.PI / 2) * Math.abs(height / 2)) / 4;
            this.offset.x = hDirection > 0 ? offX : -offX;
            this.offset.y = vDirection > 0 ? offY : -offY;
        }
        else {
            this.offset.x = 0;
            this.offset.y = 0;
        }
        ctx.beginPath();
        if (this.cropperSettings.cropperDrawSettings.lineDash) {
            ctx.setLineDash([1, 3]);
        }
        ctx.moveTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.closePath();
        ctx.fillStyle =
            this.cropperSettings.cropperDrawSettings.fillColor ||
                'rgba(255,255,255,.7)';
        ctx.fill();
    }
    moveX(x) {
        this.setPosition(x, this.position.y);
    }
    moveY(y) {
        this.setPosition(this.position.x, y);
    }
    move(x, y) {
        this.setPosition(x, y);
        this.verticalNeighbour.moveX(x);
        this.horizontalNeighbour.moveY(y);
    }
    addHorizontalNeighbour(neighbour) {
        this.horizontalNeighbour = neighbour;
    }
    addVerticalNeighbour(neighbour) {
        this.verticalNeighbour = neighbour;
    }
    getHorizontalNeighbour() {
        return this.horizontalNeighbour;
    }
    getVerticalNeighbour() {
        return this.verticalNeighbour;
    }
    draw(ctx) {
        this.drawCornerFill(ctx);
        this.drawCornerBorder(ctx);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29ybmVyTWFya2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWltZy1jcm9wcGVyLyIsInNvdXJjZXMiOlsibGliL2ltYWdlLWNyb3BwZXIvbW9kZWwvY29ybmVyTWFya2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQVcsTUFBTSxVQUFVLENBQUM7QUFRM0MsTUFBTSxPQUFPLFlBQWEsU0FBUSxNQUFNO0lBSXRDLFlBQ0UsQ0FBUyxFQUNULENBQVMsRUFDVCxNQUFjLEVBQ2QsZUFBZ0M7UUFFaEMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFTSxnQkFBZ0IsQ0FBQyxHQUE2QjtRQUNuRCxJQUFJLFVBQVUsR0FBRyxFQUFFLENBQUM7UUFDcEIsSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDMUIsVUFBVSxHQUFHLEVBQUUsQ0FBQztTQUNqQjtRQUVELElBQUksVUFBVSxHQUFXLElBQUksQ0FBQyxlQUFlLENBQUMsb0JBQW9CLENBQUM7UUFDbkUsSUFBSSxVQUFVLEdBQVcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQztRQUNuRSxJQUFJLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFO1lBQ3pELFVBQVUsR0FBRyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsb0JBQW9CLENBQUM7U0FDekQ7UUFDRCxJQUFJLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFO1lBQ3ZELFVBQVUsR0FBRyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsb0JBQW9CLENBQUM7U0FDekQ7UUFFRCxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7UUFD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QztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSGFuZGxlLCBJSGFuZGxlIH0gZnJvbSAnLi9oYW5kbGUnO1xyXG5pbXBvcnQgeyBDcm9wcGVyU2V0dGluZ3MgfSBmcm9tICcuLi9jcm9wcGVyLXNldHRpbmdzJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSUNvcm5lck1hcmtlciBleHRlbmRzIElIYW5kbGUge1xyXG4gIGhvcml6b250YWxOZWlnaGJvdXI6IENvcm5lck1hcmtlcjtcclxuICB2ZXJ0aWNhbE5laWdoYm91cjogQ29ybmVyTWFya2VyO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQ29ybmVyTWFya2VyIGV4dGVuZHMgSGFuZGxlIGltcGxlbWVudHMgSUNvcm5lck1hcmtlciB7XHJcbiAgcHVibGljIGhvcml6b250YWxOZWlnaGJvdXI6IENvcm5lck1hcmtlcjtcclxuICBwdWJsaWMgdmVydGljYWxOZWlnaGJvdXI6IENvcm5lck1hcmtlcjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB4OiBudW1iZXIsXHJcbiAgICB5OiBudW1iZXIsXHJcbiAgICByYWRpdXM6IG51bWJlcixcclxuICAgIGNyb3BwZXJTZXR0aW5nczogQ3JvcHBlclNldHRpbmdzXHJcbiAgKSB7XHJcbiAgICBzdXBlcih4LCB5LCByYWRpdXMsIGNyb3BwZXJTZXR0aW5ncyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZHJhd0Nvcm5lckJvcmRlcihjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk6IHZvaWQge1xyXG4gICAgbGV0IHNpZGVMZW5ndGggPSAxMDtcclxuICAgIGlmICh0aGlzLm92ZXIgfHwgdGhpcy5kcmFnKSB7XHJcbiAgICAgIHNpZGVMZW5ndGggPSAxMjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgaERpcmVjdGlvbjogbnVtYmVyID0gdGhpcy5jcm9wcGVyU2V0dGluZ3MubWFya2VyU2l6ZU11bHRpcGxpZXI7XHJcbiAgICBsZXQgdkRpcmVjdGlvbjogbnVtYmVyID0gdGhpcy5jcm9wcGVyU2V0dGluZ3MubWFya2VyU2l6ZU11bHRpcGxpZXI7XHJcbiAgICBpZiAodGhpcy5ob3Jpem9udGFsTmVpZ2hib3VyLnBvc2l0aW9uLnggPCB0aGlzLnBvc2l0aW9uLngpIHtcclxuICAgICAgaERpcmVjdGlvbiA9IC10aGlzLmNyb3BwZXJTZXR0aW5ncy5tYXJrZXJTaXplTXVsdGlwbGllcjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnZlcnRpY2FsTmVpZ2hib3VyLnBvc2l0aW9uLnkgPCB0aGlzLnBvc2l0aW9uLnkpIHtcclxuICAgICAgdkRpcmVjdGlvbiA9IC10aGlzLmNyb3BwZXJTZXR0aW5ncy5tYXJrZXJTaXplTXVsdGlwbGllcjtcclxuICAgIH1cclxuXHJcbiAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICBpZiAodGhpcy5jcm9wcGVyU2V0dGluZ3MuY3JvcHBlckRyYXdTZXR0aW5ncy5saW5lRGFzaCkge1xyXG4gICAgICBjdHguc2V0TGluZURhc2goWzEsIDNdKTtcclxuICAgIH1cclxuICAgIGN0eC5saW5lSm9pbiA9ICdtaXRlcic7XHJcbiAgICBjdHgubW92ZVRvKFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54LFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55XHJcbiAgICApO1xyXG4gICAgY3R4LmxpbmVUbyhcclxuICAgICAgdGhpcy5wb3NpdGlvbi54ICsgdGhpcy5vZmZzZXQueCArIHNpZGVMZW5ndGggKiBoRGlyZWN0aW9uLFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55XHJcbiAgICApO1xyXG4gICAgY3R4LmxpbmVUbyhcclxuICAgICAgdGhpcy5wb3NpdGlvbi54ICsgdGhpcy5vZmZzZXQueCArIHNpZGVMZW5ndGggKiBoRGlyZWN0aW9uLFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55ICsgc2lkZUxlbmd0aCAqIHZEaXJlY3Rpb25cclxuICAgICk7XHJcbiAgICBjdHgubGluZVRvKFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54LFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55ICsgc2lkZUxlbmd0aCAqIHZEaXJlY3Rpb25cclxuICAgICk7XHJcbiAgICBjdHgubGluZVRvKFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54LFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55XHJcbiAgICApO1xyXG4gICAgY3R4LmNsb3NlUGF0aCgpO1xyXG4gICAgY3R4LmxpbmVXaWR0aCA9IHRoaXMuY3JvcHBlclNldHRpbmdzLmNyb3BwZXJEcmF3U2V0dGluZ3Muc3Ryb2tlV2lkdGg7XHJcbiAgICBjdHguc3Ryb2tlU3R5bGUgPVxyXG4gICAgICB0aGlzLmNyb3BwZXJTZXR0aW5ncy5jcm9wcGVyRHJhd1NldHRpbmdzLnN0cm9rZUNvbG9yIHx8XHJcbiAgICAgICdyZ2JhKDI1NSwyNTUsMjU1LC43KSc7XHJcbiAgICBjdHguc3Ryb2tlKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZHJhd0Nvcm5lckZpbGwoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpOiB2b2lkIHtcclxuICAgIGxldCBzaWRlTGVuZ3RoID0gMTA7XHJcbiAgICBpZiAodGhpcy5vdmVyIHx8IHRoaXMuZHJhZykge1xyXG4gICAgICBzaWRlTGVuZ3RoID0gMTI7XHJcbiAgICB9XHJcbiAgICBsZXQgaERpcmVjdGlvbjogbnVtYmVyID0gdGhpcy5jcm9wcGVyU2V0dGluZ3MubWFya2VyU2l6ZU11bHRpcGxpZXI7XHJcbiAgICBsZXQgdkRpcmVjdGlvbjogbnVtYmVyID0gdGhpcy5jcm9wcGVyU2V0dGluZ3MubWFya2VyU2l6ZU11bHRpcGxpZXI7XHJcbiAgICBpZiAodGhpcy5ob3Jpem9udGFsTmVpZ2hib3VyLnBvc2l0aW9uLnggPCB0aGlzLnBvc2l0aW9uLngpIHtcclxuICAgICAgaERpcmVjdGlvbiA9IC10aGlzLmNyb3BwZXJTZXR0aW5ncy5tYXJrZXJTaXplTXVsdGlwbGllcjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnZlcnRpY2FsTmVpZ2hib3VyLnBvc2l0aW9uLnkgPCB0aGlzLnBvc2l0aW9uLnkpIHtcclxuICAgICAgdkRpcmVjdGlvbiA9IC10aGlzLmNyb3BwZXJTZXR0aW5ncy5tYXJrZXJTaXplTXVsdGlwbGllcjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5jcm9wcGVyU2V0dGluZ3Mucm91bmRlZCkge1xyXG4gICAgICBjb25zdCB3aWR0aDogbnVtYmVyID1cclxuICAgICAgICB0aGlzLnBvc2l0aW9uLnggLSB0aGlzLmhvcml6b250YWxOZWlnaGJvdXIucG9zaXRpb24ueDtcclxuICAgICAgY29uc3QgaGVpZ2h0OiBudW1iZXIgPVxyXG4gICAgICAgIHRoaXMucG9zaXRpb24ueSAtIHRoaXMudmVydGljYWxOZWlnaGJvdXIucG9zaXRpb24ueTtcclxuXHJcbiAgICAgIGNvbnN0IG9mZlg6IG51bWJlciA9XHJcbiAgICAgICAgTWF0aC5yb3VuZChNYXRoLnNpbihNYXRoLlBJIC8gMikgKiBNYXRoLmFicyh3aWR0aCAvIDIpKSAvIDQ7XHJcbiAgICAgIGNvbnN0IG9mZlk6IG51bWJlciA9XHJcbiAgICAgICAgTWF0aC5yb3VuZChNYXRoLnNpbihNYXRoLlBJIC8gMikgKiBNYXRoLmFicyhoZWlnaHQgLyAyKSkgLyA0O1xyXG5cclxuICAgICAgdGhpcy5vZmZzZXQueCA9IGhEaXJlY3Rpb24gPiAwID8gb2ZmWCA6IC1vZmZYO1xyXG4gICAgICB0aGlzLm9mZnNldC55ID0gdkRpcmVjdGlvbiA+IDAgPyBvZmZZIDogLW9mZlk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm9mZnNldC54ID0gMDtcclxuICAgICAgdGhpcy5vZmZzZXQueSA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgaWYgKHRoaXMuY3JvcHBlclNldHRpbmdzLmNyb3BwZXJEcmF3U2V0dGluZ3MubGluZURhc2gpIHtcclxuICAgICAgY3R4LnNldExpbmVEYXNoKFsxLCAzXSk7XHJcbiAgICB9XHJcbiAgICBjdHgubW92ZVRvKFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54LFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55XHJcbiAgICApO1xyXG4gICAgY3R4LmxpbmVUbyhcclxuICAgICAgdGhpcy5wb3NpdGlvbi54ICsgdGhpcy5vZmZzZXQueCArIHNpZGVMZW5ndGggKiBoRGlyZWN0aW9uLFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55XHJcbiAgICApO1xyXG4gICAgY3R4LmxpbmVUbyhcclxuICAgICAgdGhpcy5wb3NpdGlvbi54ICsgdGhpcy5vZmZzZXQueCArIHNpZGVMZW5ndGggKiBoRGlyZWN0aW9uLFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55ICsgc2lkZUxlbmd0aCAqIHZEaXJlY3Rpb25cclxuICAgICk7XHJcbiAgICBjdHgubGluZVRvKFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54LFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55ICsgc2lkZUxlbmd0aCAqIHZEaXJlY3Rpb25cclxuICAgICk7XHJcbiAgICBjdHgubGluZVRvKFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54LFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55XHJcbiAgICApO1xyXG4gICAgY3R4LmNsb3NlUGF0aCgpO1xyXG4gICAgY3R4LmZpbGxTdHlsZSA9XHJcbiAgICAgIHRoaXMuY3JvcHBlclNldHRpbmdzLmNyb3BwZXJEcmF3U2V0dGluZ3MuZmlsbENvbG9yIHx8XHJcbiAgICAgICdyZ2JhKDI1NSwyNTUsMjU1LC43KSc7XHJcbiAgICBjdHguZmlsbCgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG1vdmVYKHg6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5zZXRQb3NpdGlvbih4LCB0aGlzLnBvc2l0aW9uLnkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG1vdmVZKHk6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5zZXRQb3NpdGlvbih0aGlzLnBvc2l0aW9uLngsIHkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG1vdmUoeDogbnVtYmVyLCB5OiBudW1iZXIpOiB2b2lkIHtcclxuICAgIHRoaXMuc2V0UG9zaXRpb24oeCwgeSk7XHJcbiAgICB0aGlzLnZlcnRpY2FsTmVpZ2hib3VyLm1vdmVYKHgpO1xyXG4gICAgdGhpcy5ob3Jpem9udGFsTmVpZ2hib3VyLm1vdmVZKHkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFkZEhvcml6b250YWxOZWlnaGJvdXIobmVpZ2hib3VyOiBDb3JuZXJNYXJrZXIpOiB2b2lkIHtcclxuICAgIHRoaXMuaG9yaXpvbnRhbE5laWdoYm91ciA9IG5laWdoYm91cjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhZGRWZXJ0aWNhbE5laWdoYm91cihuZWlnaGJvdXI6IENvcm5lck1hcmtlcik6IHZvaWQge1xyXG4gICAgdGhpcy52ZXJ0aWNhbE5laWdoYm91ciA9IG5laWdoYm91cjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRIb3Jpem9udGFsTmVpZ2hib3VyKCk6IENvcm5lck1hcmtlciB7XHJcbiAgICByZXR1cm4gdGhpcy5ob3Jpem9udGFsTmVpZ2hib3VyO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFZlcnRpY2FsTmVpZ2hib3VyKCk6IENvcm5lck1hcmtlciB7XHJcbiAgICByZXR1cm4gdGhpcy52ZXJ0aWNhbE5laWdoYm91cjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkcmF3KGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTogdm9pZCB7XHJcbiAgICB0aGlzLmRyYXdDb3JuZXJGaWxsKGN0eCk7XHJcbiAgICB0aGlzLmRyYXdDb3JuZXJCb3JkZXIoY3R4KTtcclxuICB9XHJcbn1cclxuIl19