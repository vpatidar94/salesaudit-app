import { Handle } from './handle';
import { PointPool } from './pointPool';
export class DragMarker extends Handle {
    constructor(x, y, radius, cropperSettings) {
        super(x, y, radius, cropperSettings);
        this.iconPoints = [];
        this.scaledIconPoints = [];
        this.getDragIconPoints(this.iconPoints, 1);
        this.getDragIconPoints(this.scaledIconPoints, 1.2);
    }
    draw(ctx) {
        if (this.over || this.drag) {
            this.drawIcon(ctx, this.scaledIconPoints);
        }
        else {
            this.drawIcon(ctx, this.iconPoints);
        }
    }
    getDragIconPoints(arr, scale) {
        const maxLength = 17 * scale;
        const arrowWidth = 14 * scale;
        const arrowLength = 8 * scale;
        const connectorThroat = 4 * scale;
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(-arrowWidth / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(0, maxLength));
        arr.push(new PointPool().instance.borrow(arrowWidth / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(maxLength, 0));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, -arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(arrowWidth / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(0, -maxLength));
        arr.push(new PointPool().instance.borrow(-arrowWidth / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, -arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(-maxLength, 0));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, connectorThroat / 2));
    }
    drawIcon(ctx, points) {
        if (this.cropperSettings.showCenterMarker) {
            ctx.beginPath();
            ctx.moveTo(points[0].x + this.position.x, points[0].y + this.position.y);
            for (const p of points) {
                ctx.lineTo(p.x + this.position.x, p.y + this.position.y);
            }
            ctx.closePath();
            ctx.fillStyle = this.cropperSettings.cropperDrawSettings.dragIconFillColor;
            ctx.fill();
            ctx.lineWidth = this.cropperSettings.cropperDrawSettings.dragIconStrokeWidth;
            ctx.strokeStyle = this.cropperSettings.cropperDrawSettings.dragIconStrokeColor;
            ctx.stroke();
        }
    }
    recalculatePosition(bounds) {
        const c = bounds.getCentre();
        this.setPosition(c.x, c.y);
        new PointPool().instance.returnPoint(c);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhZ01hcmtlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1pbWctY3JvcHBlci8iLCJzb3VyY2VzIjpbImxpYi9pbWFnZS1jcm9wcGVyL21vZGVsL2RyYWdNYXJrZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUNsQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBS3hDLE1BQU0sT0FBTyxVQUFXLFNBQVEsTUFBTTtJQUlwQyxZQUNFLENBQVMsRUFDVCxDQUFTLEVBQ1QsTUFBYyxFQUNkLGVBQWdDO1FBRWhDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxlQUFlLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzNDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUVNLElBQUksQ0FBQyxHQUE2QjtRQUN2QyxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUMxQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztTQUMzQzthQUFNO1lBQ0wsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQ3JDO0lBQ0gsQ0FBQztJQUVNLGlCQUFpQixDQUFDLEdBQWUsRUFBRSxLQUFhO1FBQ3JELE1BQU0sU0FBUyxHQUFHLEVBQUUsR0FBRyxLQUFLLENBQUM7UUFDN0IsTUFBTSxVQUFVLEdBQUcsRUFB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QUFXLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxtQkFBbUIsQ0FBQyxtQkFBbUIsQ0FBQztZQUMvRSxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDZDtJQUNILENBQUM7SUFFTSxtQkFBbUIsQ0FBQyxNQUFjO1FBQ3ZDLE1BQU0sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLElBQUksU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMxQyxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIYW5kbGUgfSBmcm9tICcuL2hhbmRsZSc7XHJcbmltcG9ydCB7IFBvaW50UG9vbCB9IGZyb20gJy4vcG9pbnRQb29sJztcclxuaW1wb3J0IHsgUG9pbnQgfSBmcm9tICcuL3BvaW50JztcclxuaW1wb3J0IHsgQ3JvcHBlclNldHRpbmdzIH0gZnJvbSAnLi4vY3JvcHBlci1zZXR0aW5ncyc7XHJcbmltcG9ydCB7IEJvdW5kcyB9IGZyb20gJy4vYm91bmRzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBEcmFnTWFya2VyIGV4dGVuZHMgSGFuZGxlIHtcclxuICBwcml2YXRlIGljb25Qb2ludHM6IEFycmF5PFBvaW50PjtcclxuICBwcml2YXRlIHNjYWxlZEljb25Qb2ludHM6IEFycmF5PFBvaW50PjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB4OiBudW1iZXIsXHJcbiAgICB5OiBudW1iZXIsXHJcbiAgICByYWRpdXM6IG51bWJlcixcclxuICAgIGNyb3BwZXJTZXR0aW5nczogQ3JvcHBlclNldHRpbmdzXHJcbiAgKSB7XHJcbiAgICBzdXBlcih4LCB5LCByYWRpdXMsIGNyb3BwZXJTZXR0aW5ncyk7XHJcbiAgICB0aGlzLmljb25Qb2ludHMgPSBbXTtcclxuICAgIHRoaXMuc2NhbGVkSWNvblBvaW50cyA9IFtdO1xyXG4gICAgdGhpcy5nZXREcmFnSWNvblBvaW50cyh0aGlzLmljb25Qb2ludHMsIDEpO1xyXG4gICAgdGhpcy5nZXREcmFnSWNvblBvaW50cyh0aGlzLnNjYWxlZEljb25Qb2ludHMsIDEuMik7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZHJhdyhjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCkge1xyXG4gICAgaWYgKHRoaXMub3ZlciB8fCB0aGlzLmRyYWcpIHtcclxuICAgICAgdGhpcy5kcmF3SWNvbihjdHgsIHRoaXMuc2NhbGVkSWNvblBvaW50cyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmRyYXdJY29uKGN0eCwgdGhpcy5pY29uUG9pbnRzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXREcmFnSWNvblBvaW50cyhhcnI6IEFycmF5PGFueT4sIHNjYWxlOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IG1heExlbmd0aCA9IDE3ICogc2NhbGU7XHJcbiAgICBjb25zdCBhcnJvd1dpZHRoID0gMTQgKiBzY2FsZTtcclxuICAgIGNvbnN0IGFycm93TGVuZ3RoID0gOCAqIHNjYWxlO1xyXG4gICAgY29uc3QgY29ubmVjdG9yVGhyb2F0ID0gNCAqIHNjYWxlO1xyXG5cclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KFxyXG4gICAgICAgIC1jb25uZWN0b3JUaHJvYXQgLyAyLFxyXG4gICAgICAgIG1heExlbmd0aCAtIGFycm93TGVuZ3RoXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdygtYXJyb3dXaWR0aCAvIDIsIG1heExlbmd0aCAtIGFycm93TGVuZ3RoKVxyXG4gICAgKTtcclxuICAgIGFyci5wdXNoKG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coMCwgbWF4TGVuZ3RoKSk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhhcnJvd1dpZHRoIC8gMiwgbWF4TGVuZ3RoIC0gYXJyb3dMZW5ndGgpXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgICAgY29ubmVjdG9yVGhyb2F0IC8gMixcclxuICAgICAgICBtYXhMZW5ndGggLSBhcnJvd0xlbmd0aFxyXG4gICAgICApXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coY29ubmVjdG9yVGhyb2F0IC8gMiwgY29ubmVjdG9yVGhyb2F0IC8gMilcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhcclxuICAgICAgICBtYXhMZW5ndGggLSBhcnJvd0xlbmd0aCxcclxuICAgICAgICBjb25uZWN0b3JUaHJvYXQgLyAyXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhtYXhMZW5ndGggLSBhcnJvd0xlbmd0aCwgYXJyb3dXaWR0aCAvIDIpXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2gobmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhtYXhMZW5ndGgsIDApKTtcclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KG1heExlbmd0aCAtIGFycm93TGVuZ3RoLCAtYXJyb3dXaWR0aCAvIDIpXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgICAgbWF4TGVuZ3RoIC0gYXJyb3dMZW5ndGgsXHJcbiAgICAgICAgLWNvbm5lY3RvclRocm9hdCAvIDJcclxuICAgICAgKVxyXG4gICAgKTtcclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KGNvbm5lY3RvclRocm9hdCAvIDIsIC1jb25uZWN0b3JUaHJvYXQgLyAyKVxyXG4gICAgKTtcclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KFxyXG4gICAgICAgIGNvbm5lY3RvclRocm9hdCAvIDIsXHJcbiAgICAgICAgLW1heExlbmd0aCArIGFycm93TGVuZ3RoXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhhcnJvd1dpZHRoIC8gMiwgLW1heExlbmd0aCArIGFycm93TGVuZ3RoKVxyXG4gICAgKTtcclxuICAgIGFyci5wdXNoKG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coMCwgLW1heExlbmd0aCkpO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coLWFycm93V2lkdGggLyAyLCAtbWF4TGVuZ3RoICsgYXJyb3dMZW5ndGgpXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgICAgLWNvbm5lY3RvclRocm9hdCAvIDIsXHJcbiAgICAgICAgLW1heExlbmd0aCArIGFycm93TGVuZ3RoXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhcclxuICAgICAgICAtY29ubmVjdG9yVGhyb2F0IC8gMixcclxuICAgICAgICAtY29ubmVjdG9yVGhyb2F0IC8gMlxyXG4gICAgICApXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgICAgLW1heExlbmd0aCArIGFycm93TGVuZ3RoLFxyXG4gICAgICAgIC1jb25uZWN0b3JUaHJvYXQgLyAyXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdygtbWF4TGVuZ3RoICsgYXJyb3dMZW5ndGgsIC1hcnJvd1dpZHRoIC8gMilcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KC1tYXhMZW5ndGgsIDApKTtcclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KC1tYXhMZW5ndGggKyBhcnJvd0xlbmd0aCwgYXJyb3dXaWR0aCAvIDIpXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgICAgLW1heExlbmd0aCArIGFycm93TGVuZ3RoLFxyXG4gICAgICAgIGNvbm5lY3RvclRocm9hdCAvIDJcclxuICAgICAgKVxyXG4gICAgKTtcclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KC1jb25uZWN0b3JUaHJvYXQgLyAyLCBjb25uZWN0b3JUaHJvYXQgLyAyKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkcmF3SWNvbihjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgcG9pbnRzOiBBcnJheTxQb2ludD4pIHtcclxuICAgIGlmICh0aGlzLmNyb3BwZXJTZXR0aW5ncy5zaG93Q2VudGVyTWFya2VyKSB7XHJcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgY3R4Lm1vdmVUbyhwb2ludHNbMF0ueCArIHRoaXMucG9zaXRpb24ueCwgcG9pbnRzWzBdLnkgKyB0aGlzLnBvc2l0aW9uLnkpO1xyXG4gICAgICBmb3IgKGNvbnN0IHAgb2YgcG9pbnRzKSB7XHJcbiAgICAgICAgY3R4LmxpbmVUbyhwLnggKyB0aGlzLnBvc2l0aW9uLngsIHAueSArIHRoaXMucG9zaXRpb24ueSk7XHJcbiAgICAgIH1cclxuICAgICAgY3R4LmNsb3NlUGF0aCgpO1xyXG4gICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5jcm9wcGVyU2V0dGluZ3MuY3JvcHBlckRyYXdTZXR0aW5ncy5kcmFnSWNvbkZpbGxDb2xvcjtcclxuICAgICAgY3R4LmZpbGwoKTtcclxuICAgICAgY3R4LmxpbmVXaWR0aCA9IHRoaXMuY3JvcHBlclNldHRpbmdzLmNyb3BwZXJEcmF3U2V0dGluZ3MuZHJhZ0ljb25TdHJva2VXaWR0aDtcclxuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5jcm9wcGVyU2V0dGluZ3MuY3JvcHBlckRyYXdTZXR0aW5ncy5kcmFnSWNvblN0cm9rZUNvbG9yO1xyXG4gICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVjYWxjdWxhdGVQb3NpdGlvbihib3VuZHM6IEJvdW5kcykge1xyXG4gICAgY29uc3QgYyA9IGJvdW5kcy5nZXRDZW50cmUoKTtcclxuICAgIHRoaXMuc2V0UG9zaXRpb24oYy54LCBjLnkpO1xyXG4gICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLnJldHVyblBvaW50KGMpO1xyXG4gIH1cclxufVxyXG4iXX0=