import { __extends, __values } from "tslib";
import { Handle } from './handle';
import { PointPool } from './pointPool';
var DragMarker = /** @class */ (function (_super) {
    __extends(DragMarker, _super);
    function DragMarker(x, y, radius, cropperSettings) {
        var _this = _super.call(this, x, y, radius, cropperSettings) || this;
        _this.iconPoints = [];
        _this.scaledIconPoints = [];
        _this.getDragIconPoints(_this.iconPoints, 1);
        _this.getDragIconPoints(_this.scaledIconPoints, 1.2);
        return _this;
    }
    DragMarker.prototype.draw = function (ctx) {
        if (this.over || this.drag) {
            this.drawIcon(ctx, this.scaledIconPoints);
        }
        else {
            this.drawIcon(ctx, this.iconPoints);
        }
    };
    DragMarker.prototype.getDragIconPoints = function (arr, scale) {
        var maxLength = 17 * scale;
        var arrowWidth = 14 * scale;
        var arrowLength = 8 * scale;
        var connectorThroat = 4 * scale;
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(-arrowWidth / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(0, maxLength));
        arr.push(new PointPool().instance.borrow(arrowWidth / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(maxLength, 0));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, -arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(arrowWidth / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(0, -maxLength));
        arr.push(new PointPool().instance.borrow(-arrowWidth / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, -arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(-maxLength, 0));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, connectorThroat / 2));
    };
    DragMarker.prototype.drawIcon = function (ctx, points) {
        var e_1, _a;
        if (this.cropperSettings.showCenterMarker) {
            ctx.beginPath();
            ctx.moveTo(points[0].x + this.position.x, points[0].y + this.position.y);
            try {
                for (var points_1 = __values(points), points_1_1 = points_1.next(); !points_1_1.done; points_1_1 = points_1.next()) {
                    var p = points_1_1.value;
                    ctx.lineTo(p.x + this.position.x, p.y + this.position.y);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (points_1_1 && !points_1_1.done && (_a = points_1.return)) _a.call(points_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            ctx.closePath();
            ctx.fillStyle = this.cropperSettings.cropperDrawSettings.dragIconFillColor;
            ctx.fill();
            ctx.lineWidth = this.cropperSettings.cropperDrawSettings.dragIconStrokeWidth;
            ctx.strokeStyle = this.cropperSettings.cropperDrawSettings.dragIconStrokeColor;
            ctx.stroke();
        }
    };
    DragMarker.prototype.recalculatePosition = function (bounds) {
        var c = bounds.getCentre();
        this.setPosition(c.x, c.y);
        new PointPool().instance.returnPoint(c);
    };
    return DragMarker;
}(Handle));
export { DragMarker };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhZ01hcmtlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1pbWctY3JvcHBlci8iLCJzb3VyY2VzIjpbImxpYi9pbWFnZS1jcm9wcGVyL21vZGVsL2RyYWdNYXJrZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDbEMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUt4QztJQUFnQyw4QkFBTTtJQUlwQyxvQkFDRSxDQUFTLEVBQ1QsQ0FBUyxFQUNULE1BQWMsRUFDZCxlQUFnQztRQUpsQyxZQU1FLGtCQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLGVBQWUsQ0FBQyxTQUtyQztRQUpDLEtBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLEtBQUksQ0FBQyxnQkFBZ0IsR0FBRyxFQUFFLENBQUM7UUFDM0IsS0FBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDM0MsS0FBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUksQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLENBQUMsQ0FBQzs7SUFDckQsQ0FBQztJQUVNLHlCQUFJLEdBQVgsVUFBWSxHQUE2QjtRQUN2QyxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUMxQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztTQUMzQzthQUFNO1lBQ0wsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQ3JDO0lBQ0gsQ0FBQztJQUVNLHNDQUFpQixHQUF4QixVQUF5QixHQUFlLEVBQUUsS0FBYTtRQUNyRCxJQUFNLFNBQVMsR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFDO1FBQzdCLElBQU0sVUFBVSxHQUFH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SSxDQUFDLGVBQWUsQ0FBQyxtQkFBbUIsQ0FBQyxtQkFBbUIsQ0FBQztZQUM3RSxHQUFHLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsbUJBQW1CLENBQUMsbUJBQW1CLENBQUM7WUFDL0UsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQ2Q7SUFDSCxDQUFDO0lBRU0sd0NBQW1CLEdBQTFCLFVBQTJCLE1BQWM7UUFDdkMsSUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0IsSUFBSSxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFDSCxpQkFBQztBQUFELENBQUMsQUFqSkQsQ0FBZ0MsTUFBTSxHQWlKckMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIYW5kbGUgfSBmcm9tICcuL2hhbmRsZSc7XHJcbmltcG9ydCB7IFBvaW50UG9vbCB9IGZyb20gJy4vcG9pbnRQb29sJztcclxuaW1wb3J0IHsgUG9pbnQgfSBmcm9tICcuL3BvaW50JztcclxuaW1wb3J0IHsgQ3JvcHBlclNldHRpbmdzIH0gZnJvbSAnLi4vY3JvcHBlci1zZXR0aW5ncyc7XHJcbmltcG9ydCB7IEJvdW5kcyB9IGZyb20gJy4vYm91bmRzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBEcmFnTWFya2VyIGV4dGVuZHMgSGFuZGxlIHtcclxuICBwcml2YXRlIGljb25Qb2ludHM6IEFycmF5PFBvaW50PjtcclxuICBwcml2YXRlIHNjYWxlZEljb25Qb2ludHM6IEFycmF5PFBvaW50PjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB4OiBudW1iZXIsXHJcbiAgICB5OiBudW1iZXIsXHJcbiAgICByYWRpdXM6IG51bWJlcixcclxuICAgIGNyb3BwZXJTZXR0aW5nczogQ3JvcHBlclNldHRpbmdzXHJcbiAgKSB7XHJcbiAgICBzdXBlcih4LCB5LCByYWRpdXMsIGNyb3BwZXJTZXR0aW5ncyk7XHJcbiAgICB0aGlzLmljb25Qb2ludHMgPSBbXTtcclxuICAgIHRoaXMuc2NhbGVkSWNvblBvaW50cyA9IFtdO1xyXG4gICAgdGhpcy5nZXREcmFnSWNvblBvaW50cyh0aGlzLmljb25Qb2ludHMsIDEpO1xyXG4gICAgdGhpcy5nZXREcmFnSWNvblBvaW50cyh0aGlzLnNjYWxlZEljb25Qb2ludHMsIDEuMik7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZHJhdyhjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCkge1xyXG4gICAgaWYgKHRoaXMub3ZlciB8fCB0aGlzLmRyYWcpIHtcclxuICAgICAgdGhpcy5kcmF3SWNvbihjdHgsIHRoaXMuc2NhbGVkSWNvblBvaW50cyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmRyYXdJY29uKGN0eCwgdGhpcy5pY29uUG9pbnRzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXREcmFnSWNvblBvaW50cyhhcnI6IEFycmF5PGFueT4sIHNjYWxlOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IG1heExlbmd0aCA9IDE3ICogc2NhbGU7XHJcbiAgICBjb25zdCBhcnJvd1dpZHRoID0gMTQgKiBzY2FsZTtcclxuICAgIGNvbnN0IGFycm93TGVuZ3RoID0gOCAqIHNjYWxlO1xyXG4gICAgY29uc3QgY29ubmVjdG9yVGhyb2F0ID0gNCAqIHNjYWxlO1xyXG5cclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KFxyXG4gICAgICAgIC1jb25uZWN0b3JUaHJvYXQgLyAyLFxyXG4gICAgICAgIG1heExlbmd0aCAtIGFycm93TGVuZ3RoXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdygtYXJyb3dXaWR0aCAvIDIsIG1heExlbmd0aCAtIGFycm93TGVuZ3RoKVxyXG4gICAgKTtcclxuICAgIGFyci5wdXNoKG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coMCwgbWF4TGVuZ3RoKSk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhhcnJvd1dpZHRoIC8gMiwgbWF4TGVuZ3RoIC0gYXJyb3dMZW5ndGgpXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgICAgY29ubmVjdG9yVGhyb2F0IC8gMixcclxuICAgICAgICBtYXhMZW5ndGggLSBhcnJvd0xlbmd0aFxyXG4gICAgICApXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coY29ubmVjdG9yVGhyb2F0IC8gMiwgY29ubmVjdG9yVGhyb2F0IC8gMilcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhcclxuICAgICAgICBtYXhMZW5ndGggLSBhcnJvd0xlbmd0aCxcclxuICAgICAgICBjb25uZWN0b3JUaHJvYXQgLyAyXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhtYXhMZW5ndGggLSBhcnJvd0xlbmd0aCwgYXJyb3dXaWR0aCAvIDIpXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2gobmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhtYXhMZW5ndGgsIDApKTtcclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KG1heExlbmd0aCAtIGFycm93TGVuZ3RoLCAtYXJyb3dXaWR0aCAvIDIpXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgICAgbWF4TGVuZ3RoIC0gYXJyb3dMZW5ndGgsXHJcbiAgICAgICAgLWNvbm5lY3RvclRocm9hdCAvIDJcclxuICAgICAgKVxyXG4gICAgKTtcclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KGNvbm5lY3RvclRocm9hdCAvIDIsIC1jb25uZWN0b3JUaHJvYXQgLyAyKVxyXG4gICAgKTtcclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KFxyXG4gICAgICAgIGNvbm5lY3RvclRocm9hdCAvIDIsXHJcbiAgICAgICAgLW1heExlbmd0aCArIGFycm93TGVuZ3RoXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhhcnJvd1dpZHRoIC8gMiwgLW1heExlbmd0aCArIGFycm93TGVuZ3RoKVxyXG4gICAgKTtcclxuICAgIGFyci5wdXNoKG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coMCwgLW1heExlbmd0aCkpO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coLWFycm93V2lkdGggLyAyLCAtbWF4TGVuZ3RoICsgYXJyb3dMZW5ndGgpXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgICAgLWNvbm5lY3RvclRocm9hdCAvIDIsXHJcbiAgICAgICAgLW1heExlbmd0aCArIGFycm93TGVuZ3RoXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhcclxuICAgICAgICAtY29ubmVjdG9yVGhyb2F0IC8gMixcclxuICAgICAgICAtY29ubmVjdG9yVGhyb2F0IC8gMlxyXG4gICAgICApXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgICAgLW1heExlbmd0aCArIGFycm93TGVuZ3RoLFxyXG4gICAgICAgIC1jb25uZWN0b3JUaHJvYXQgLyAyXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChcclxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdygtbWF4TGVuZ3RoICsgYXJyb3dMZW5ndGgsIC1hcnJvd1dpZHRoIC8gMilcclxuICAgICk7XHJcbiAgICBhcnIucHVzaChuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KC1tYXhMZW5ndGgsIDApKTtcclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KC1tYXhMZW5ndGggKyBhcnJvd0xlbmd0aCwgYXJyb3dXaWR0aCAvIDIpXHJcbiAgICApO1xyXG4gICAgYXJyLnB1c2goXHJcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXHJcbiAgICAgICAgLW1heExlbmd0aCArIGFycm93TGVuZ3RoLFxyXG4gICAgICAgIGNvbm5lY3RvclRocm9hdCAvIDJcclxuICAgICAgKVxyXG4gICAgKTtcclxuICAgIGFyci5wdXNoKFxyXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KC1jb25uZWN0b3JUaHJvYXQgLyAyLCBjb25uZWN0b3JUaHJvYXQgLyAyKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkcmF3SWNvbihjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgcG9pbnRzOiBBcnJheTxQb2ludD4pIHtcclxuICAgIGlmICh0aGlzLmNyb3BwZXJTZXR0aW5ncy5zaG93Q2VudGVyTWFya2VyKSB7XHJcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgY3R4Lm1vdmVUbyhwb2ludHNbMF0ueCArIHRoaXMucG9zaXRpb24ueCwgcG9pbnRzWzBdLnkgKyB0aGlzLnBvc2l0aW9uLnkpO1xyXG4gICAgICBmb3IgKGNvbnN0IHAgb2YgcG9pbnRzKSB7XHJcbiAgICAgICAgY3R4LmxpbmVUbyhwLnggKyB0aGlzLnBvc2l0aW9uLngsIHAueSArIHRoaXMucG9zaXRpb24ueSk7XHJcbiAgICAgIH1cclxuICAgICAgY3R4LmNsb3NlUGF0aCgpO1xyXG4gICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5jcm9wcGVyU2V0dGluZ3MuY3JvcHBlckRyYXdTZXR0aW5ncy5kcmFnSWNvbkZpbGxDb2xvcjtcclxuICAgICAgY3R4LmZpbGwoKTtcclxuICAgICAgY3R4LmxpbmVXaWR0aCA9IHRoaXMuY3JvcHBlclNldHRpbmdzLmNyb3BwZXJEcmF3U2V0dGluZ3MuZHJhZ0ljb25TdHJva2VXaWR0aDtcclxuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5jcm9wcGVyU2V0dGluZ3MuY3JvcHBlckRyYXdTZXR0aW5ncy5kcmFnSWNvblN0cm9rZUNvbG9yO1xyXG4gICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVjYWxjdWxhdGVQb3NpdGlvbihib3VuZHM6IEJvdW5kcykge1xyXG4gICAgY29uc3QgYyA9IGJvdW5kcy5nZXRDZW50cmUoKTtcclxuICAgIHRoaXMuc2V0UG9zaXRpb24oYy54LCBjLnkpO1xyXG4gICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLnJldHVyblBvaW50KGMpO1xyXG4gIH1cclxufVxyXG4iXX0=