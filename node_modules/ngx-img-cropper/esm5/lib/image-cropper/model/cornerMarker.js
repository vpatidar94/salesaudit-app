import { __extends } from "tslib";
import { Handle } from './handle';
var CornerMarker = /** @class */ (function (_super) {
    __extends(CornerMarker, _super);
    function CornerMarker(x, y, radius, cropperSettings) {
        return _super.call(this, x, y, radius, cropperSettings) || this;
    }
    CornerMarker.prototype.drawCornerBorder = function (ctx) {
        var sideLength = 10;
        if (this.over || this.drag) {
            sideLength = 12;
        }
        var hDirection = this.cropperSettings.markerSizeMultiplier;
        var vDirection = this.cropperSettings.markerSizeMultiplier;
        if (this.horizontalNeighbour.position.x < this.position.x) {
            hDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        if (this.verticalNeighbour.position.y < this.position.y) {
            vDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        ctx.beginPath();
        if (this.cropperSettings.cropperDrawSettings.lineDash) {
            ctx.setLineDash([1, 3]);
        }
        ctx.lineJoin = 'miter';
        ctx.moveTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.closePath();
        ctx.lineWidth = this.cropperSettings.cropperDrawSettings.strokeWidth;
        ctx.strokeStyle =
            this.cropperSettings.cropperDrawSettings.strokeColor ||
                'rgba(255,255,255,.7)';
        ctx.stroke();
    };
    CornerMarker.prototype.drawCornerFill = function (ctx) {
        var sideLength = 10;
        if (this.over || this.drag) {
            sideLength = 12;
        }
        var hDirection = this.cropperSettings.markerSizeMultiplier;
        var vDirection = this.cropperSettings.markerSizeMultiplier;
        if (this.horizontalNeighbour.position.x < this.position.x) {
            hDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        if (this.verticalNeighbour.position.y < this.position.y) {
            vDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        if (this.cropperSettings.rounded) {
            var width = this.position.x - this.horizontalNeighbour.position.x;
            var height = this.position.y - this.verticalNeighbour.position.y;
            var offX = Math.round(Math.sin(Math.PI / 2) * Math.abs(width / 2)) / 4;
            var offY = Math.round(Math.sin(Math.PI / 2) * Math.abs(height / 2)) / 4;
            this.offset.x = hDirection > 0 ? offX : -offX;
            this.offset.y = vDirection > 0 ? offY : -offY;
        }
        else {
            this.offset.x = 0;
            this.offset.y = 0;
        }
        ctx.beginPath();
        if (this.cropperSettings.cropperDrawSettings.lineDash) {
            ctx.setLineDash([1, 3]);
        }
        ctx.moveTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.closePath();
        ctx.fillStyle =
            this.cropperSettings.cropperDrawSettings.fillColor ||
                'rgba(255,255,255,.7)';
        ctx.fill();
    };
    CornerMarker.prototype.moveX = function (x) {
        this.setPosition(x, this.position.y);
    };
    CornerMarker.prototype.moveY = function (y) {
        this.setPosition(this.position.x, y);
    };
    CornerMarker.prototype.move = function (x, y) {
        this.setPosition(x, y);
        this.verticalNeighbour.moveX(x);
        this.horizontalNeighbour.moveY(y);
    };
    CornerMarker.prototype.addHorizontalNeighbour = function (neighbour) {
        this.horizontalNeighbour = neighbour;
    };
    CornerMarker.prototype.addVerticalNeighbour = function (neighbour) {
        this.verticalNeighbour = neighbour;
    };
    CornerMarker.prototype.getHorizontalNeighbour = function () {
        return this.horizontalNeighbour;
    };
    CornerMarker.prototype.getVerticalNeighbour = function () {
        return this.verticalNeighbour;
    };
    CornerMarker.prototype.draw = function (ctx) {
        this.drawCornerFill(ctx);
        this.drawCornerBorder(ctx);
    };
    return CornerMarker;
}(Handle));
export { CornerMarker };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29ybmVyTWFya2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWltZy1jcm9wcGVyLyIsInNvdXJjZXMiOlsibGliL2ltYWdlLWNyb3BwZXIvbW9kZWwvY29ybmVyTWFya2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFXLE1BQU0sVUFBVSxDQUFDO0FBUTNDO0lBQWtDLGdDQUFNO0lBSXRDLHNCQUNFLENBQVMsRUFDVCxDQUFTLEVBQ1QsTUFBYyxFQUNkLGVBQWdDO2VBRWhDLGtCQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLGVBQWUsQ0FBQztJQUN0QyxDQUFDO0lBRU0sdUNBQWdCLEdBQXZCLFVBQXdCLEdBQTZCO1FBQ25ELElBQUksVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNwQixJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUMxQixVQUFVLEdBQUcsRUFBRSxDQUFDO1NBQ2pCO1FBRUQsSUFBSSxVQUFVLEdBQVcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQztRQUNuRSxJQUFJLFVBQVUsR0FBVyxJQUFJLENBQUMsZUFBZSxDQUFDLG9CQUFvQixDQUFDO1FBQ25FLElBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUU7WUFDekQsVUFBVSxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQztTQUN6RDtRQUNELElBQUksSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUU7WUFDdkQsVUFBVSxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQztTQUN6RDtRQUVELEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNoQixJQUFJLElBQUks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SSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFDSCxtQkFBQztBQUFELENBQUMsQUE5SkQsQ0FBa0MsTUFBTSxHQThKdkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIYW5kbGUsIElIYW5kbGUgfSBmcm9tICcuL2hhbmRsZSc7XHJcbmltcG9ydCB7IENyb3BwZXJTZXR0aW5ncyB9IGZyb20gJy4uL2Nyb3BwZXItc2V0dGluZ3MnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJQ29ybmVyTWFya2VyIGV4dGVuZHMgSUhhbmRsZSB7XHJcbiAgaG9yaXpvbnRhbE5laWdoYm91cjogQ29ybmVyTWFya2VyO1xyXG4gIHZlcnRpY2FsTmVpZ2hib3VyOiBDb3JuZXJNYXJrZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDb3JuZXJNYXJrZXIgZXh0ZW5kcyBIYW5kbGUgaW1wbGVtZW50cyBJQ29ybmVyTWFya2VyIHtcclxuICBwdWJsaWMgaG9yaXpvbnRhbE5laWdoYm91cjogQ29ybmVyTWFya2VyO1xyXG4gIHB1YmxpYyB2ZXJ0aWNhbE5laWdoYm91cjogQ29ybmVyTWFya2VyO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIHJhZGl1czogbnVtYmVyLFxyXG4gICAgY3JvcHBlclNldHRpbmdzOiBDcm9wcGVyU2V0dGluZ3NcclxuICApIHtcclxuICAgIHN1cGVyKHgsIHksIHJhZGl1cywgY3JvcHBlclNldHRpbmdzKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkcmF3Q29ybmVyQm9yZGVyKGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTogdm9pZCB7XHJcbiAgICBsZXQgc2lkZUxlbmd0aCA9IDEwO1xyXG4gICAgaWYgKHRoaXMub3ZlciB8fCB0aGlzLmRyYWcpIHtcclxuICAgICAgc2lkZUxlbmd0aCA9IDEyO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBoRGlyZWN0aW9uOiBudW1iZXIgPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5tYXJrZXJTaXplTXVsdGlwbGllcjtcclxuICAgIGxldCB2RGlyZWN0aW9uOiBudW1iZXIgPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5tYXJrZXJTaXplTXVsdGlwbGllcjtcclxuICAgIGlmICh0aGlzLmhvcml6b250YWxOZWlnaGJvdXIucG9zaXRpb24ueCA8IHRoaXMucG9zaXRpb24ueCkge1xyXG4gICAgICBoRGlyZWN0aW9uID0gLXRoaXMuY3JvcHBlclNldHRpbmdzLm1hcmtlclNpemVNdWx0aXBsaWVyO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudmVydGljYWxOZWlnaGJvdXIucG9zaXRpb24ueSA8IHRoaXMucG9zaXRpb24ueSkge1xyXG4gICAgICB2RGlyZWN0aW9uID0gLXRoaXMuY3JvcHBlclNldHRpbmdzLm1hcmtlclNpemVNdWx0aXBsaWVyO1xyXG4gICAgfVxyXG5cclxuICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgIGlmICh0aGlzLmNyb3BwZXJTZXR0aW5ncy5jcm9wcGVyRHJhd1NldHRpbmdzLmxpbmVEYXNoKSB7XHJcbiAgICAgIGN0eC5zZXRMaW5lRGFzaChbMSwgM10pO1xyXG4gICAgfVxyXG4gICAgY3R4LmxpbmVKb2luID0gJ21pdGVyJztcclxuICAgIGN0eC5tb3ZlVG8oXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueCArIHRoaXMub2Zmc2V0LngsXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnlcclxuICAgICk7XHJcbiAgICBjdHgubGluZVRvKFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54ICsgc2lkZUxlbmd0aCAqIGhEaXJlY3Rpb24sXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnlcclxuICAgICk7XHJcbiAgICBjdHgubGluZVRvKFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54ICsgc2lkZUxlbmd0aCAqIGhEaXJlY3Rpb24sXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnkgKyBzaWRlTGVuZ3RoICogdkRpcmVjdGlvblxyXG4gICAgKTtcclxuICAgIGN0eC5saW5lVG8oXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueCArIHRoaXMub2Zmc2V0LngsXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnkgKyBzaWRlTGVuZ3RoICogdkRpcmVjdGlvblxyXG4gICAgKTtcclxuICAgIGN0eC5saW5lVG8oXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueCArIHRoaXMub2Zmc2V0LngsXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnlcclxuICAgICk7XHJcbiAgICBjdHguY2xvc2VQYXRoKCk7XHJcbiAgICBjdHgubGluZVdpZHRoID0gdGhpcy5jcm9wcGVyU2V0dGluZ3MuY3JvcHBlckRyYXdTZXR0aW5ncy5zdHJva2VXaWR0aDtcclxuICAgIGN0eC5zdHJva2VTdHlsZSA9XHJcbiAgICAgIHRoaXMuY3JvcHBlclNldHRpbmdzLmNyb3BwZXJEcmF3U2V0dGluZ3Muc3Ryb2tlQ29sb3IgfHxcclxuICAgICAgJ3JnYmEoMjU1LDI1NSwyNTUsLjcpJztcclxuICAgIGN0eC5zdHJva2UoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkcmF3Q29ybmVyRmlsbChjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk6IHZvaWQge1xyXG4gICAgbGV0IHNpZGVMZW5ndGggPSAxMDtcclxuICAgIGlmICh0aGlzLm92ZXIgfHwgdGhpcy5kcmFnKSB7XHJcbiAgICAgIHNpZGVMZW5ndGggPSAxMjtcclxuICAgIH1cclxuICAgIGxldCBoRGlyZWN0aW9uOiBudW1iZXIgPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5tYXJrZXJTaXplTXVsdGlwbGllcjtcclxuICAgIGxldCB2RGlyZWN0aW9uOiBudW1iZXIgPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5tYXJrZXJTaXplTXVsdGlwbGllcjtcclxuICAgIGlmICh0aGlzLmhvcml6b250YWxOZWlnaGJvdXIucG9zaXRpb24ueCA8IHRoaXMucG9zaXRpb24ueCkge1xyXG4gICAgICBoRGlyZWN0aW9uID0gLXRoaXMuY3JvcHBlclNldHRpbmdzLm1hcmtlclNpemVNdWx0aXBsaWVyO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudmVydGljYWxOZWlnaGJvdXIucG9zaXRpb24ueSA8IHRoaXMucG9zaXRpb24ueSkge1xyXG4gICAgICB2RGlyZWN0aW9uID0gLXRoaXMuY3JvcHBlclNldHRpbmdzLm1hcmtlclNpemVNdWx0aXBsaWVyO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmNyb3BwZXJTZXR0aW5ncy5yb3VuZGVkKSB7XHJcbiAgICAgIGNvbnN0IHdpZHRoOiBudW1iZXIgPVxyXG4gICAgICAgIHRoaXMucG9zaXRpb24ueCAtIHRoaXMuaG9yaXpvbnRhbE5laWdoYm91ci5wb3NpdGlvbi54O1xyXG4gICAgICBjb25zdCBoZWlnaHQ6IG51bWJlciA9XHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbi55IC0gdGhpcy52ZXJ0aWNhbE5laWdoYm91ci5wb3NpdGlvbi55O1xyXG5cclxuICAgICAgY29uc3Qgb2ZmWDogbnVtYmVyID1cclxuICAgICAgICBNYXRoLnJvdW5kKE1hdGguc2luKE1hdGguUEkgLyAyKSAqIE1hdGguYWJzKHdpZHRoIC8gMikpIC8gNDtcclxuICAgICAgY29uc3Qgb2ZmWTogbnVtYmVyID1cclxuICAgICAgICBNYXRoLnJvdW5kKE1hdGguc2luKE1hdGguUEkgLyAyKSAqIE1hdGguYWJzKGhlaWdodCAvIDIpKSAvIDQ7XHJcblxyXG4gICAgICB0aGlzLm9mZnNldC54ID0gaERpcmVjdGlvbiA+IDAgPyBvZmZYIDogLW9mZlg7XHJcbiAgICAgIHRoaXMub2Zmc2V0LnkgPSB2RGlyZWN0aW9uID4gMCA/IG9mZlkgOiAtb2ZmWTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMub2Zmc2V0LnggPSAwO1xyXG4gICAgICB0aGlzLm9mZnNldC55ID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICBpZiAodGhpcy5jcm9wcGVyU2V0dGluZ3MuY3JvcHBlckRyYXdTZXR0aW5ncy5saW5lRGFzaCkge1xyXG4gICAgICBjdHguc2V0TGluZURhc2goWzEsIDNdKTtcclxuICAgIH1cclxuICAgIGN0eC5tb3ZlVG8oXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueCArIHRoaXMub2Zmc2V0LngsXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnlcclxuICAgICk7XHJcbiAgICBjdHgubGluZVRvKFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54ICsgc2lkZUxlbmd0aCAqIGhEaXJlY3Rpb24sXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnlcclxuICAgICk7XHJcbiAgICBjdHgubGluZVRvKFxyXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54ICsgc2lkZUxlbmd0aCAqIGhEaXJlY3Rpb24sXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnkgKyBzaWRlTGVuZ3RoICogdkRpcmVjdGlvblxyXG4gICAgKTtcclxuICAgIGN0eC5saW5lVG8oXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueCArIHRoaXMub2Zmc2V0LngsXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnkgKyBzaWRlTGVuZ3RoICogdkRpcmVjdGlvblxyXG4gICAgKTtcclxuICAgIGN0eC5saW5lVG8oXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueCArIHRoaXMub2Zmc2V0LngsXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnlcclxuICAgICk7XHJcbiAgICBjdHguY2xvc2VQYXRoKCk7XHJcbiAgICBjdHguZmlsbFN0eWxlID1cclxuICAgICAgdGhpcy5jcm9wcGVyU2V0dGluZ3MuY3JvcHBlckRyYXdTZXR0aW5ncy5maWxsQ29sb3IgfHxcclxuICAgICAgJ3JnYmEoMjU1LDI1NSwyNTUsLjcpJztcclxuICAgIGN0eC5maWxsKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbW92ZVgoeDogbnVtYmVyKTogdm9pZCB7XHJcbiAgICB0aGlzLnNldFBvc2l0aW9uKHgsIHRoaXMucG9zaXRpb24ueSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbW92ZVkoeTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICB0aGlzLnNldFBvc2l0aW9uKHRoaXMucG9zaXRpb24ueCwgeSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbW92ZSh4OiBudW1iZXIsIHk6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5zZXRQb3NpdGlvbih4LCB5KTtcclxuICAgIHRoaXMudmVydGljYWxOZWlnaGJvdXIubW92ZVgoeCk7XHJcbiAgICB0aGlzLmhvcml6b250YWxOZWlnaGJvdXIubW92ZVkoeSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYWRkSG9yaXpvbnRhbE5laWdoYm91cihuZWlnaGJvdXI6IENvcm5lck1hcmtlcik6IHZvaWQge1xyXG4gICAgdGhpcy5ob3Jpem9udGFsTmVpZ2hib3VyID0gbmVpZ2hib3VyO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFkZFZlcnRpY2FsTmVpZ2hib3VyKG5laWdoYm91cjogQ29ybmVyTWFya2VyKTogdm9pZCB7XHJcbiAgICB0aGlzLnZlcnRpY2FsTmVpZ2hib3VyID0gbmVpZ2hib3VyO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEhvcml6b250YWxOZWlnaGJvdXIoKTogQ29ybmVyTWFya2VyIHtcclxuICAgIHJldHVybiB0aGlzLmhvcml6b250YWxOZWlnaGJvdXI7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VmVydGljYWxOZWlnaGJvdXIoKTogQ29ybmVyTWFya2VyIHtcclxuICAgIHJldHVybiB0aGlzLnZlcnRpY2FsTmVpZ2hib3VyO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGRyYXcoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpOiB2b2lkIHtcclxuICAgIHRoaXMuZHJhd0Nvcm5lckZpbGwoY3R4KTtcclxuICAgIHRoaXMuZHJhd0Nvcm5lckJvcmRlcihjdHgpO1xyXG4gIH1cclxufVxyXG4iXX0=